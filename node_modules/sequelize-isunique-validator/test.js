/* global require */
var Sequelize = require('sequelize');
require('./lib')(Sequelize);
var db = new Sequelize('database', 'username', 'password', {
    dialect: 'sqlite',
    storage: './test/database.sqlite',
    logging: true
});
var UserModel;
var isuniqueUsernameMsg = 'Please choose a different username';
var dataset = {
    user1: {
        name: 'John Doe',
        email: 'jdoe@example.com',
        username: 'jdoe'
    },
    user2: {
        name: 'Jane Doe',
        email: 'jdoe@example.com',
        username: 'jdoe1'
    },
    user3: {
        name: 'Jack Does',
        email: 'jackdoes@example.com',
        username: 'jdoe'
    }
};
UserModel = db.define('UserModel', {
    name: Sequelize.STRING,
    email: {
        type: Sequelize.STRING,
        validate: {
            isUnique: db.validateIsUnique('email')
        }
    },
    username: {
        type: Sequelize.STRING,
        validate: {
            isUnique: db.validateIsUnique('username', isuniqueUsernameMsg)
        }
    }
});

UserModel.sync({
    force: true
}).then(function () {
    return UserModel.create(dataset.user1);
}).then(function () {
    UserModel.findOne({
        where: {
            email: dataset.user1.email
        }
    }).then(function (user) {
        user.name += ' II';
//        user.email += 'm';
//        user.username += 'm';
        user.validate().then(function (err) {
            console.log(err);
        });
    });

});